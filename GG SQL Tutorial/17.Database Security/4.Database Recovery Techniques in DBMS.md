Os sistemas de banco de dados, como qualquer outro sistema de computador, estão sujeitos a falhas, mas os dados armazenados neles devem estar disponíveis como e quando necessário. Quando um banco de dados falha, ele deve possuir os recursos para recuperação rápida. Também deve ter atomicidade, ou seja, as transações são concluídas com sucesso e confirmadas (o efeito é registrado permanentemente no banco de dados) ou a transação não deve ter efeito no banco de dados.

## Tipos de técnicas de recuperação em DBMS

As técnicas de recuperação de banco de dados são usadas em sistemas de gerenciamento de banco de dados (DBMS) para restaurar um banco de dados a um estado consistente após a ocorrência de uma falha ou erro. O principal objetivo das técnicas de recuperação é garantir a integridade e consistência dos dados e evitar a perda de dados.

Existem basicamente dois tipos de técnicas de recuperação usadas no SGBD

- **Técnica de recuperação de reversão/desfazer**
- **Técnica de recuperação de confirmação/refazer**
- **Técnica de recuperação de ponto de verificação**

### **Técnica de recuperação de reversão/desfazer**

A técnica de recuperação de reversão/desfazer baseia-se no princípio de recuar ou desfazer os efeitos de uma transação que não foi concluída com êxito devido a uma falha ou erro do sistema. Essa técnica é realizada desfazendo as alterações feitas pela transação usando os registros de log armazenados no log de transações. O log de transações contém um registro de todas as transações que foram executadas no banco de dados. O sistema usa os registros de log para desfazer as alterações feitas pela transação com falha e restaurar o banco de dados ao seu estado anterior.

### **Técnica de recuperação de confirmação/refazer**

A técnica de recuperação de confirmação/refazer baseia-se no princípio de reaplicar as alterações feitas por uma transação que foi concluída com êxito no banco de dados. Essa técnica é realizada usando os registros de log armazenados no log de transações para refazer as alterações feitas pela transação que estava em andamento no momento da falha ou erro. O sistema usa os registros de log para reaplicar as alterações feitas pela transação e restaurar o banco de dados para seu estado consistente mais recente.

### Técnica de recuperação de checkpoint

[A recuperação de ponto de verificação](https://www.geeksforgeeks.org/checkpoints-in-dbms/)é uma técnica usada para melhorar a integridade dos dados e a estabilidade do sistema, especialmente em bancos de dados e sistemas distribuídos. Isso implica preservar o estado do sistema em intervalos regulares, conhecidos como pontos de verificação, nos quais todas as transações em andamento são concluídas ou não iniciadas. Esse estado salvo, que inclui registros de memória e CPU, é mantido em armazenamento estável e não volátil para que possa suportar falhas do sistema. Em caso de avaria, o sistema pode ser restaurado para o ponto de verificação mais recente, o que reduz a perda de dados e o tempo de inatividade. A frequência de formação do ponto de verificação é cuidadosamente regulada para diminuir a sobrecarga do sistema, garantindo que os dados recentes possam ser restaurados rapidamente.

No geral, as técnicas de recuperação são essenciais para garantir a consistência e disponibilidade dos dados no [Sistema de Gerenciamento de Banco de Dados](https://www.geeksforgeeks.org/introduction-of-dbms-database-management-system-set-1/), e cada técnica tem suas próprias vantagens e limitações que devem ser consideradas no projeto de um sistema de recuperação.

## **Sistemas de banco de dados**

Existem maneiras automáticas e não automáticas para ambos, backup de dados e recuperação de qualquer situação de falha. As técnicas usadas para recuperar dados perdidos devido a falhas do sistema, erros de transação, vírus, falhas catastróficas, execução incorreta de comandos, etc. são técnicas de recuperação de banco de dados. Portanto, para evitar a perda de dados, podem ser usadas técnicas de recuperação baseadas em atualizações adiadas e atualizações imediatas ou backup de dados. As técnicas de recuperação dependem muito da existência de um arquivo especial conhecido como log do sistema. Ele contém informações sobre o início e o fim de cada transação e quaisquer atualizações que ocorram durante a transação. O log controla todas as operações de transação que afetam os valores dos itens do banco de dados. Essas informações são necessárias para se recuperar da falha da transação.

- **O log é mantido no disco start_transaction(T):** essa entrada de log registra que a transação T inicia a execução.
- **read_item(T, X):** essa entrada de log registra que a transação T lê o valor do item X do banco de dados.
- **write_item(T, X, old_value, new_value):** essa entrada de log registra que a transação T altera o valor do item de banco de dados X de old_value para new_value. O valor antigo às vezes é conhecido como antes de uma imagem de X, e o novo valor é conhecido como uma pós-imagem de X.
- **commit(T):** Esta entrada de log registra que a transação T concluiu todos os acessos ao banco de dados com êxito e seu efeito pode ser confirmado (registrado permanentemente) no banco de dados.
- **abort(T):** registra que a transação T foi anulada.
- **checkpoint:** Um ponto de verificação é um mecanismo em que todos os logs anteriores são removidos do sistema e armazenados permanentemente em um disco de armazenamento. O ponto de verificação declara um ponto antes do qual o DBMS estava em um estado consistente e todas as transações foram confirmadas.

Uma transação T atinge seu ponto de confirmação quando todas as suas operações que acessam o banco de dados foram executadas com sucesso, ou seja, a transação atingiu o ponto em que não será abortada (encerrada sem concluir). Uma vez confirmada, a transação é registrada permanentemente no banco de dados. O compromisso sempre envolve a gravação de uma entrada de confirmação no log e a gravação do log no disco. No momento de uma falha do sistema, o item é pesquisado de volta no log para todas as transações T que gravaram uma entrada start_transaction(T) no log, mas ainda não gravaram uma entrada commit(T); Essas transações podem ter que ser revertidas para desfazer seu efeito no banco de dados durante o processo de recuperação.

- **Desfazer:** Se uma transação falhar, o gerenciador de recuperação poderá desfazer transações, ou seja, reverter as operações de uma transação. Isso envolve examinar uma transação para a entrada de log write_item(T, x, old_value, new_value) e definir o valor do item x no banco de dados como valor antigo. Existem duas técnicas principais para recuperação de falhas de transação não catastróficas: [atualizações adiadas e atualizações imediatas.](https://www.geeksforgeeks.org/difference-between-deferred-update-and-immediate-update/)
- **Atualização adiada:** essa técnica não atualiza fisicamente o banco de dados em disco até que uma transação atinja seu ponto de confirmação. Antes de atingir a confirmação, todas as atualizações de transação são registradas no espaço de trabalho de transação local. Se uma transação falhar antes de atingir seu ponto de confirmação, ela não terá alterado o banco de dados de forma alguma, portanto, UNDO não é necessário. Pode ser necessário REFAZER o efeito das operações registradas no espaço de trabalho de transação local, pois seu efeito pode ainda não ter sido gravado no banco de dados. Portanto, uma atualização adiada também é conhecida como algoritmo No-undo/redo.
- **Atualização imediata:** Na atualização imediata, o banco de dados pode ser atualizado por algumas operações de uma transação antes que a transação atinja seu ponto de confirmação. No entanto, essas operações são registradas em um log em disco antes de serem aplicadas ao banco de dados, tornando a recuperação ainda possível. Se uma transação não atingir seu ponto de confirmação, o efeito de sua operação deve ser desfeito, ou seja, a transação deve ser revertida, portanto, exigimos desfazer e refazer. Essa técnica é conhecida como algoritmo de desfazer/refazer.
- **Cache/Buffer:** Nesta ou mais páginas de disco que incluem itens de dados a serem atualizados são armazenadas em cache nos buffers da memória principal e, em seguida, atualizadas na memória antes de serem gravadas de volta no disco. Uma coleção de buffers na memória chamada cache do DBMS é mantida sob o controle do DBMS para manter esses buffers. Um diretório é usado para controlar quais itens de banco de dados estão no buffer. Um bit sujo é associado a cada buffer, que é 0 se o buffer não for modificado, caso contrário, 1 se modificado.
- **Paginação de Sombra:** Fornece atomicidade e durabilidade. Um diretório com n entradas é construído, onde a i-ésima entrada aponta para a i-ésima página do banco de dados no link. Quando uma transação começa a ser executada, o diretório atual é copiado para um diretório de sombra. Quando uma página deve ser modificada, uma página de sombra é alocada na qual são feitas alterações e quando está pronta para se tornar durável, todas as páginas que se referem ao original são atualizadas para se referir a uma nova página de substituição.
- **Recuperação para trás:** O termo " **Rollback** " e " **UNDO** " também pode se referir à recuperação para trás. Quando um backup dos dados não está disponível e as modificações anteriores precisam ser desfeitas, essa técnica pode ser útil. Com o método de recuperação regressiva, as modificações não utilizadas são removidas e o banco de dados é retornado à sua condição anterior. Todos os ajustes feitos durante a tração anterior são revertidos durante a recuperação para trás. Em outras palavras, ele reprocessa transações válidas e desfaz as atualizações errôneas do banco de dados.
- **Recuperação de encaminhamento:** " **Roll forward** " e " **REDO** " referem-se à recuperação de encaminhamento. Quando um banco de dados precisa ser atualizado com todas as alterações verificadas, essa técnica de recuperação direta é útil. Algumas transações com falha nesse banco de dados são aplicadas ao banco de dados para efetuar roll forward. Em outras palavras, o banco de dados é restaurado usando dados preservados e transações válidas contadas por seus salvamentos anteriores.

## Técnicas de backup

Existem diferentes tipos de técnicas de backup. Alguns deles estão listados abaixo.

- **Backup completo do banco de dados:** Neste banco de dados completo, incluindo dados e banco de dados, as metainformações necessárias para restaurar todo o banco de dados, incluindo catálogos de texto completo, são armazenadas em backup em uma série temporal predefinida.
- **Backup diferencial:** armazena apenas as alterações de dados que ocorreram desde o último backup completo do banco de dados. Quando alguns dados foram alterados muitas vezes desde o último backup completo do banco de dados, um backup diferencial armazena a versão mais recente dos dados alterados. Para isso, primeiro, precisamos restaurar um backup completo do banco de dados.
- **Backup do log de transações:** Neste, todos os eventos que ocorreram no banco de dados, como um registro de cada instrução executada, são copiados. É o backup das entradas do log de transações e contém todas as transações que aconteceram no banco de dados. Com isso, o banco de dados pode ser recuperado para um ponto específico no tempo. É até possível executar um backup de um log de transações se os arquivos de dados forem destruídos e nem mesmo uma única transação confirmada for perdida.

## Conclusão

Para que a disponibilidade e a consistência dos dados sejam sempre garantidas, os sistemas de banco de dados devem ser à prova de falhas. Restaurar a consistência do banco de dados pode exigir o emprego de muitas técnicas de recuperação, como reversão/desfazer, confirmação/refazer e recuperação de ponto de verificação. Essas soluções aproveitam os logs do sistema e das transações para monitorar e regular as alterações de dados. A abordagem de recuperação ideal é determinada pelos requisitos e restrições específicos do sistema de [banco de dados](https://www.geeksforgeeks.org/what-is-database/). O design correto dos métodos de recuperação é essencial para reduzir a perda de dados, manter a integridade dos dados e garantir a confiabilidade do sistema de gerenciamento de banco de dados.


